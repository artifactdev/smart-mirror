!function(o){"use strict";function n(o,n,e,t,c,i,a,m,d,r,u,l,s,g,f){function h(){f({url:"http://widgets.vvo-online.de/abfahrtsmonitor/Abfahrten.do?hst=trachenbergerplatz&vz=0&lim=7",dataType:"json",method:"GET",headers:{"Content-Type":"application/json"}}).success(function(o,n,e,t){u.tram=o,p(o)}).error(function(o,n,e,t){console.log(JSON.stringify(o))})}function p(o){u.tram=o,console.log(u.tram)}function v(){u.date=new moment}var y=this,b='Say "What can I say?" to see a list of commands...';u.listening=!1,u.debug=!1,u.focus="default",u.user={},u.commands=commands,u.interimResult=b,u.tram=null,u.layoutName="main",u.locale=config.language,g.set(config.language.toLowerCase()),moment.locale(config.language),console.log("moment local",moment.locale()),h(),s(h,2e4);var C=function(){u.interimResult=b};y.init=function(){var c=s(v,1e3);v(),n.getLocation({enableHighAccuracy:!0}).then(function(o){console.log("Geoposition",o),u.map=t.generateMap(o.coords.latitude+","+o.coords.longitude)}),C();var g=function(){n.getLocation({enableHighAccuracy:!0}).then(function(o){console.log("Geoposition",o),e.init(o).then(function(){u.currentForcast=e.currentForcast(),u.weeklyForcast=e.weeklyForcast(),u.hourlyForcast=e.hourlyForcast(),console.log("Current",u.currentForcast),console.log("Weekly",u.weeklyForcast),console.log("Hourly",u.hourlyForcast);var o=new Skycons({color:"#aaa"});o.add("icon_weather_current",u.currentForcast.iconAnimation),o.play(),u.iconLoad=function(n,e){o.add(document.getElementById(n),e),o.play()}})},function(o){console.log(o)}),a.getCalendarEvents().then(function(o){u.calendar=a.getFutureEvents()},function(o){console.log(o)})};g(),s(g,15e5);var f=function(){if(Array.isArray(config.greeting)||"undefined"==typeof config.greeting.midday)Array.isArray(config.greeting)&&(u.greeting=config.greeting[Math.floor(Math.random()*config.greeting.length)]);else{var o=moment().hour(),n="midday";o>4&&11>o?n="morning":o>18&&23>o?n="evening":(o>=23||4>o)&&(n="night"),u.greeting=config.greeting[n][Math.floor(Math.random()*config.greeting.morning.length)]}};f(),s(f,12e4);var h=function(){r.getTravelDuration().then(function(o){console.log("Traffic",o),u.traffic={destination:config.traffic.name,duration:o}},function(o){u.traffic={error:o}})};h(),s(h,6e4*config.traffic.reload_interval);var p=function(){console.log("Refreshing comic"),m.initDilbert().then(function(o){console.log("Dilbert comic initialized")},function(o){console.log(o)})};p(),s(p,432e5);var y=function(){console.debug("Ok, going to default view..."),u.focus="default"};o.addCommand(commands.list.voice,function(){console.debug("Here is a list of commands..."),console.log(o.commands),u.focus="commands"}),o.addCommand(commands.home.voice,y),o.addCommand(commands.sleep.voice,function(){console.debug("Ok, going to sleep..."),u.focus="sleep"}),o.addCommand(commands.wake_up.voice,function(){y()}),o.addCommand(commands.debug.voice,function(){console.debug("Boop Boop. Showing debug info..."),u.debug=!0}),o.addCommand(commands.map_show.voice,function(){console.debug("Going on an adventure?"),n.getLocation({enableHighAccuracy:!0}).then(function(o){console.log("Geoposition",o),u.map=t.generateMap(o.coords.latitude+","+o.coords.longitude),u.focus="map"})}),o.addCommand(commands.map_location.voice,function(o){console.debug("Getting map of",o),u.map=t.generateMap(o),u.focus="map"}),o.addCommand(commands.map_zoom_in.voice,function(){console.debug("Zoooooooom!!!"),u.map=t.zoomIn()}),o.addCommand(commands.map_zoom_out.voice,function(){console.debug("Moooooooooz!!!"),u.map=t.zoomOut()}),o.addCommand(commands.map_zoom_point.voice,function(o){console.debug("Moooop!!!",o),u.map=t.zoomTo(o)}),o.addCommand(commands.map_zoom_reset.voice,function(){console.debug("Zoooommmmmzzz00000!!!"),u.map=t.reset(),u.focus="map"}),o.addCommand(commands.images_search.voice,function(o){console.debug("Showing",o)}),o.addCommand(commands.account_set_name.voice,function(o){console.debug("Hi",o,"nice to meet you"),u.user.name=o}),o.addCommand(commands.reminder_insert.voice,function(o){console.debug("I'll remind you to",o)}),o.addCommand(commands.reminder_clear.voice,function(){console.debug("Clearing reminders")}),o.addCommand(commands.time_show.voice,function(o){console.debug("It is",moment().format("h:mm:ss a"))}),o.addCommand(commands.light_action.voice,function(o,n){i.performUpdate(o+" "+n)}),o.addCommand(commands.image_giphy.voice,function(o){d.init(o).then(function(){u.gifimg=d.giphyImg(),u.focus="gif"})}),o.addCommand(commands.image_comic.voice,function(o,n){console.debug("Fetching a comic for you."),m.getXKCD().then(function(o){u.xkcd=o.img,u.focus="xkcd"})}),o.addCommand("Show Dilbert (comic)",function(o,n){console.debug("Fetching a Dilbert comic for you."),u.dilbert=m.getDilbert("today"),u.focus="dilbert"});var b;o.start(function(o){u.listening=o},function(o){u.interimResult=o,l.cancel(b)},function(o){u.interimResult=o[0],b=l(C,5e3)})},y.init()}function e(o){o.layoutName="undefined"!=typeof config.layout&&config.layout?config.layout:"main"}o.module("SmartMirror").controller("MirrorCtrl",n),o.module("SmartMirror").controller("Theme",e)}(window.angular);