!function(o){"use strict";function n(o,n,e,t,i,c,r,a,u,s,l,m,g,f,d,p,h,b,y,_){function v(){_({url:"http://widgets.vvo-online.de/abfahrtsmonitor/Abfahrten.do?hst="+config.tram.stop+"&vz="+config.tram.vz+"&lim="+config.tram.limit,dataType:"json",method:"GET",headers:{"Content-Type":"application/json"}}).success(function(o,n,e,t){d.tram=o,w(o)}).error(function(o,n,e,t){console.log(JSON.stringify(o))})}function w(o){d.tram=o}function z(){d.date=new moment}var M=this;d.listening=!1,d.debug=!1,d.focus="default",d.user={},d.commands=[],d.interimResult=y.instant("home.commands"),d.layoutName="main",d.fitbitEnabled=!1,"undefined"!=typeof config.fitbit&&(d.fitbitEnabled=!0),d.locale=config.language,b.set(config.language.toLowerCase()),moment.locale(config.language),console.log("moment local",moment.locale()),d.getTramClass=function(o){return 5>o?"red":o>=5&&7>o?"orange":"green"},v(),h(v,2e4);var F=function(){y("home.commands").then(function(o){d.interimResult=o})};M.init=function(){var f=h(z,1e3);z(),d.rain=c.generateMap(),n.getLocation({enableHighAccuracy:!0}).then(function(o){console.log("Geoposition",o),d.map=i.generateMap(o.coords.latitude+","+o.coords.longitude)}),F();var b=function(){n.getLocation({enableHighAccuracy:!0}).then(function(o){console.log("Geoposition",o),e.init(o).then(function(){d.currentForcast=e.currentForcast(),d.weeklyForcast=e.weeklyForcast(),d.hourlyForcast=e.hourlyForcast(),console.log("Current",d.currentForcast),console.log("Weekly",d.weeklyForcast),console.log("Hourly",d.hourlyForcast);var o=new Skycons({color:"#aaa"});o.add("icon_weather_current",d.currentForcast.iconAnimation),o.play(),d.iconLoad=function(n,e){o.add(document.getElementById(n),e),o.play()}})},function(o){console.log(o)}),a.getCalendarEvents().then(function(o){d.calendar=a.getFutureEvents()},function(o){console.log(o)}),d.fitbitEnabled&&setTimeout(function(){_()},5e3)},_=function(){console.log("refreshing fitbit data"),t.profileSummary(function(o){d.fbDailyAverage=o}),t.todaySummary(function(o){d.fbToday=o})};b(),h(b,108e3);var v=function(){if(Array.isArray(config.greeting)||"undefined"==typeof config.greeting.midday)Array.isArray(config.greeting)&&(d.greeting=config.greeting[Math.floor(Math.random()*config.greeting.length)]);else{var o=moment().hour(),n="midday";o>4&&11>o?n="morning":o>18&&23>o?n="evening":(o>=23||4>o)&&(n="night");var e=Math.floor(Math.random()*config.greeting[n].length),t=config.greeting[n][e];d.greeting=t}};v(),h(v,12e4);var w=function(){l.getDurationForTrips().then(function(o){console.log("Traffic",o),d.trips=o},function(o){d.traffic={error:o}})};w(),h(w,6e4*config.traffic.reload_interval);var M=function(){console.log("Refreshing comic"),u.initDilbert().then(function(o){console.log("Dilbert comic initialized")},function(o){console.log(o)})};M();var k=function(){console.debug("Ok, going to default view..."),d.focus="default"};h(M,432e5);var S=function(n,e){var t="commands."+n+".voice",i="commands."+n+".text",c="commands."+n+".description";y([t,i,c]).then(function(n){if(o.addCommand(n[t],e),""!=n[i]){var r={text:n[i],description:n[c]};d.commands.push(r)}})};S("list",function(){console.debug("Here is a list of commands..."),console.log(o.commands),d.focus="commands"}),S("home",k),S("sleep",function(){console.debug("Ok, going to sleep..."),d.focus="sleep"}),S("wake_up",k),S("debug",function(){console.debug("Boop Boop. Showing debug info..."),d.debug=!0}),S("map_show",function(){console.debug("Going on an adventure?"),n.getLocation({enableHighAccuracy:!0}).then(function(o){console.log("Geoposition",o),d.map=i.generateMap(o.coords.latitude+","+o.coords.longitude),d.focus="map"})}),S("map_location",function(o){console.debug("Getting map of",o),d.map=i.generateMap(o),d.focus="map"}),S("map_zoom_in",function(){console.debug("Zoooooooom!!!"),d.map=i.zoomIn()}),S("map_zoom_out",function(){console.debug("Moooooooooz!!!"),d.map=i.zoomOut()}),S("map_zoom_point",function(o){console.debug("Moooop!!!",o),d.map=i.zoomTo(o)}),S("map_zoom_reset",function(){console.debug("Zoooommmmmzzz00000!!!"),d.map=i.reset(),d.focus="map"}),S("images_search",function(o){console.debug("Showing",o)}),S("reminder_insert",function(o){console.debug("I'll remind you to",o),d.reminders=g.insertReminder(o),d.focus="reminders"}),S("reminder_clear",function(){console.debug("Clearing reminders"),d.reminders=g.clearReminder(),d.focus="default"}),S("reminder_show",function(){console.debug("Showing reminders"),d.reminders=g.getReminders(),d.focus="reminders"}),S("time_show",function(o){console.debug("It is",moment().format("h:mm:ss a"))}),S("light_action",function(o,n){r.performUpdate(o+" "+n)}),S("image_giphy",function(o){s.init(o).then(function(){d.gifimg=s.giphyImg(),d.focus="gif"})}),d.fitbitEnabled&&o.addCommand("show my walking",function(){_()}),S("image_comic",function(o,n){console.debug("Fetching a comic for you."),u.getXKCD().then(function(o){d.xkcd=o.img,d.focus="xkcd"})}),S("image_comic_dilbert",function(o,n){console.debug("Fetching a Dilbert comic for you."),d.dilbert=u.getDilbert("today"),d.focus="dilbert"}),S("timer_start",function(o){console.debug("Starting timer"),m.start(o),d.timer=m,d.focus="timer",d.$watch("timer.countdown",function(o){0===o&&m.stop()})}),S("timer_show",function(){m.running&&(m.paused?(m.start(),m.stop()):m.start(),d.focus="timer")}),S("timer_stop",function(){m.running&&!m.paused&&m.stop()}),S("timer_resume",function(){m.running&&m.paused&&(m.start(),d.focus="timer")}),S("rain_show",function(){d.map=c.generateMap(),d.focus="rain"}),d.rainMap=function(){return config.rain.url};var A;o.start(function(o){d.listening=o},function(o){d.interimResult=o,p.cancel(A)},function(o){"undefined"!=typeof o&&(d.interimResult=o[0],A=p(F,5e3))},function(n){console.log(n),"network"==n.error&&(d.speechError="Google Speech Recognizer is down :(",o.abort())})},M.init()}function e(o){o.layoutName="undefined"!=typeof config.layout&&config.layout?config.layout:"main"}o.module("SmartMirror").controller("MirrorCtrl",n),o.module("SmartMirror").controller("Theme",e)}(window.angular);